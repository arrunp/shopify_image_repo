{% extends "repo/base.html" %}
{% block content %}

{% if found_images %}
<div style="display:none;">
    <form method="post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <button type="submit">Submit</button>
    </form>
</div>
{% else %}
<h5 class="my-3 my-lg-3">Upload your image here:</h5>
<div style="display:block;">
    <form method=" post" enctype="multipart/form-data">
        {% csrf_token %}
        {{ form.as_p }}
        <p>If you have multiple tags, <strong>please separate your tags with a comma</strong></p>
        <button class="btn btn-primary" type="submit">Submit</button>
    </form>
    <hr>
</div>
{% endif %}

<!--IMAGE SEARCH AND UPLOADED LIST-->

<form action="{% url 'imageSearch' %}" method=" get" class="form-inline my-3 my-lg-3">
    <input class="form-control mr-sm-2" type="search" name="imageSearch" placeholder="Search" aria-label="Search">
    <button class="btn btn-primary" type="submit"><i class="fa fa-search"></i></button>
</form>

{% if current_image_name != None %}
<div class="alert alert-warning alert-dismissible fade show" role="alert">
    <p>Due to an image with the same name, image name was changed to '{{ current_image_name }}.'</p>
    <button type="button" class="close" data-dismiss="alert" aria-label="Close">
        <span aria-hidden="true">&times;</span>
    </button>
</div>
{% endif %}
<table>
    <thead>
        <tr>
            <th>Title</th>
            <th>Name</th>
            <th>Uploaded at</th>
            <th>Size</th>
            <th>Tags</th>
        </tr>
    </thead>
    <tbody>

        {% if found_images %}
        <a href="{% url 'home' %}"><button class="btn btn-primary">Back to Home</button></a>
        <h5 class="my-3 my-lg-3">Search Results: </h5>
        {% for image in found_images %}
        <tr>
            <td>{{ image.title }}</td>
            <td><a href="{{ image.image.url }}" target="_blank">{{ image.image.name }}</a></td>
            <td>{{ image.date }} EST</td>
            <td>{{ image.image.size|filesizeformat }}</td>
            <td>{{ image.tags }}</td>
            <td>
                <form action="{% url 'imageDelete' image.id %}" method="POST">
                    {% csrf_token %}
                    <input name="imageDelete" type="submit" value="Delete"
                        onclick="return confirm('Are you sure you would like to delete this image?');" />
                </form>
            </td>
        </tr>
        {% endfor %}
        {% else %}
        <h5 class="my-3 my-lg-3">Uploaded Images:</h5>
        {% for image in images %}
        <tr>
            <td>{{ image.title }}</td>
            <td><a href="{{ image.image.url }}" target="_blank">{{ image.image.name }}</a></td>
            <td>{{ image.date }} EST</td>
            <td>{{ image.image.size|filesizeformat }}</td>
            <td>{{ image.tags }}</td>
            <td>
                <form action="{% url 'imageDelete' image.id %}" method="POST">
                    {% csrf_token %}
                    <input name="imageDelete" type="submit" value="Delete"
                        onclick="return confirm('Are you sure you would like to delete this image?');" />
                </form>
            </td>
        </tr>
        {{ image.image.thumbnail }}
        {% empty %}
        <tr>
            <td colspan="3">No data.</td>
        </tr>
        <a href="{% url 'home' %}"><button class="btn btn-primary">Click to Refresh</button></a>
        {% endfor %}
        {% endif %}

    </tbody>
</table>
{% endblock content %}